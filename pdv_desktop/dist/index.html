<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PDV Desktop - I9 Smart</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: #1a1a2e;
      color: #fff;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    .container {
      width: 100%;
      max-width: 480px;
      padding: 20px;
    }

    .card {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 32px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    .logo {
      text-align: center;
      margin-bottom: 24px;
    }

    .logo img {
      width: 80px;
      height: 80px;
      border-radius: 16px;
    }

    .logo h1 {
      font-size: 24px;
      font-weight: 600;
      margin-top: 12px;
      color: #fff;
    }

    .logo p {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.6);
      margin-top: 4px;
    }

    .wizard-steps {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 24px;
    }

    .step-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      transition: all 0.3s;
    }

    .step-dot.active {
      background: #4facfe;
      transform: scale(1.2);
    }

    .step-dot.completed {
      background: #4ade80;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 8px;
      color: rgba(255, 255, 255, 0.9);
    }

    .form-group input, .form-group select {
      width: 100%;
      padding: 12px 16px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 8px;
      color: #fff;
      font-size: 16px;
      transition: all 0.3s;
    }

    .form-group input:focus, .form-group select:focus {
      outline: none;
      border-color: #4facfe;
      background: rgba(255, 255, 255, 0.12);
    }

    .form-group input::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }

    .form-group select option {
      background: #1a1a2e;
      color: #fff;
    }

    .form-group .helper {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.5);
      margin-top: 6px;
    }

    .form-row {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 12px;
    }

    .btn {
      width: 100%;
      padding: 14px 24px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-primary {
      background: #3b82f6;
      color: #fff;
    }

    .btn-primary:hover {
      background: #2563eb;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      margin-top: 12px;
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.15);
    }

    .btn-group {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }

    .btn-group .btn {
      flex: 1;
    }

    .loading-container {
      text-align: center;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(255, 255, 255, 0.1);
      border-left-color: #4facfe;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .error-message {
      background: rgba(239, 68, 68, 0.2);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: #fca5a5;
      padding: 12px 16px;
      border-radius: 8px;
      font-size: 14px;
      margin-bottom: 20px;
      display: none;
    }

    .success-message {
      background: rgba(74, 222, 128, 0.2);
      border: 1px solid rgba(74, 222, 128, 0.3);
      color: #86efac;
      padding: 12px 16px;
      border-radius: 8px;
      font-size: 14px;
      margin-bottom: 20px;
      text-align: center;
    }

    .hidden {
      display: none !important;
    }

    .section-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 20px;
      color: #fff;
      text-align: center;
    }

    .config-link {
      text-align: center;
      margin-top: 16px;
    }

    .config-link a {
      color: rgba(255, 255, 255, 0.6);
      font-size: 14px;
      text-decoration: none;
      transition: color 0.3s;
    }

    .config-link a:hover {
      color: #4facfe;
    }

    .field-locked {
      position: relative;
    }

    .field-locked::after {
      content: "üîí";
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 14px;
    }

    .field-locked input, .field-locked select {
      background: rgba(255, 255, 255, 0.03);
      cursor: not-allowed;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 8px;
    }

    .checkbox-group input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: #4facfe;
    }

    .checkbox-group label {
      margin: 0;
      font-size: 14px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Tela de Loading -->
    <div id="loading-screen" class="card">
      <div class="loading-container">
        <div class="spinner"></div>
        <h1>PDV Desktop</h1>
        <p style="color: rgba(255,255,255,0.6); margin-top: 8px;">Carregando sistema...</p>
      </div>
    </div>

    <!-- Wizard de Configura√ß√£o -->
    <div id="wizard-screen" class="card hidden">
      <div class="logo">
        <img src="data:image/png;base64,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" alt="I9 Smart PDV">
        <h1>PDV Desktop</h1>
        <p>Configura√ß√£o Inicial</p>
      </div>


      <div id="error-message" class="error-message"></div>

      <!-- Step 1: Servidor -->
      <div id="step1">
        <div class="section-title">Etapa 1 - Conex√£o com Servidor</div>

        <div class="form-row">
          <div class="form-group">
            <label for="server-ip">IP do Servidor</label>
            <input type="text" id="server-ip" placeholder="192.168.1.100 ou localhost" value="localhost">
          </div>
          <div class="form-group">
            <label for="server-port">Porta</label>
            <input type="number" id="server-port" placeholder="4000" value="4000">
          </div>
        </div>

        <button class="btn btn-primary" onclick="testConnection()" style="margin-bottom: 12px;">
          <span id="test-btn-text">Testar Conex√£o</span>
          <div id="test-spinner" class="spinner hidden" style="width:20px;height:20px;margin:0;border-width:2px;"></div>
        </button>

        <div id="connection-status" class="success-message hidden" style="margin-bottom: 16px;">
          Conex√£o estabelecida com sucesso!
        </div>

        <button class="btn btn-primary" onclick="goToStep2()" id="next-btn" disabled style="opacity: 0.5;">
          Pr√≥ximo
        </button>
      </div>

      <!-- Step 2: Configura√ß√µes Opcionais -->
      <div id="step2" class="hidden">
        <div class="section-title">Etapa 2 - Configura√ß√µes Opcionais</div>

        <div class="form-group">
          <label for="grupo-empresa">Grupo de Empresa</label>
          <input type="text" id="grupo-empresa" placeholder="Nome ou ID do grupo (opcional)">
        </div>

        <div class="form-group">
          <label for="empresa">Empresa</label>
          <input type="text" id="empresa" placeholder="Nome ou ID da empresa (opcional)">
        </div>

        <div class="form-group">
          <label for="estacao">Esta√ß√£o</label>
          <input type="text" id="estacao" placeholder="C√≥digo da esta√ß√£o (opcional)">
        </div>

        <p class="helper" style="margin-bottom: 16px; text-align: center;">Deixe em branco para selecionar ap√≥s login</p>

        <div class="btn-group">
          <button class="btn btn-secondary" onclick="goToStep1()" style="margin-top: 0;">Voltar</button>
          <button class="btn btn-primary" onclick="saveConfig()">Salvar e Iniciar</button>
        </div>
      </div>
    </div>

    <!-- Tela de Configura√ß√µes -->
    <div id="settings-screen" class="card hidden">
      <div class="logo">
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAADACAYAAABS3GwHAAAACXBIWXMAAAsTAAALEwEAmpwYAAAI0ElEQVR4nO3de4xdVRXH8e+0M53pTJ8UCi2ltKWl0AJFCMojEQQEASEoIRqNPyiJ0RhfMRoTjYmJxvhIjH8Y/zBqfCQaH4kPgqIg8pIHCFhe8iqFUqD0PdP3TOcPc+qZ6dy5d+6cc+/ee/b6JJO5d86cM3tnr9lnn73WPgUREREREREREREREREREREREREREREREREREREREREREZHMNORuQI2mAjOAKcBBwMCc7ZlMpzMH6AA6gbeBjcB6YEXu5mV2NLAAuAN4GCjk/HMG0gfx2fAE8CLwPHA/8BnghJztS9NRhfMxHejK1YYvAH9n9J/9IjAXeFsKxy6c2bm7gGnABuAa4CJAy+D6ayywwf5srdZutc3AYuBW4CLglkocaFKdG10FHAM8DZyQpxlN6QHglcL/NwM+BTyWpR0T4djCOZAAbgvr+r4p7RNdN6Xjj0DfAc7P+h8vnBPhYOBXwHLgROBf6TbDbr8CPgvcnLsNoRwD3Aicl7sxjWYqcBdwY47jN0d/AGAD5hT4NOBW4N3A0zlblMgngbuAL+VuSCNx+CZwbu5GNLIPAY/mboQEVJiD8znwZ+BiO/eBfC0K4EfApbkbIeE4nPDPAj6TuyE++xqwNHcjJI9JwNe5uwCHpy3EL4HPAe/O3RDxjMNrwCsLr1yXux2++Q/wOWBt7oZIHg47gP2BObnb4Zt2e3xK7oZIPg4b/MOB9tzN8M00YFruRkheQw3/GcDU3I3xzfn22Jq7IZLXkMN/KdCau0G+afWPoOKSoYZ/WxM1JIkCjSP1+QfYBHTnboj4x+E0YFLuhvhmMrpXW/bjcCZwRO6G+OZI4KzcjRD/OJxM3BPKwToc2C93IyQPh1NRQEg/OqEAOEDu03YjuxuwPncjJJ+2pmMWTudsNq/u3I2QfIY7CrgAOD53Y7xTuBT4Qu6GSB5DDf+FwH65G+Obw4CLczdC8hhq+D8CjMndEN8c45+/u0X26srdgBFpscd2R+6GSB5DDf85wPjcjfHNOODc3I2QfJwdBZyYuyG+OREYk7sRkofDqcAxuRvinRnAibkbIfk4vLZwQe52+OXCwv/v0djBYPaLw3lACxLQJ1EgRL8UEg5nB4ATCvELtZI1yt0Pf8PhZKAld2O8c7J/KDxC9sdhK3Bq7ob4ZxqaD9Bvh9OBqbkb4p1pKBCkX04D/MlcW8hQpykqEGT/HM4Hxtn9IaIkOBpdhJIA3gT8FDghd0N8cwKaESwB7J0DMD7r4X8ydyN8MyZ3A8TPQYCL7VE/7A+U3SqwjyD2PnzMtcdDczdE8nFYBhyduxG+ORo4OncjJJ+h+gHOAQ7N3RDfHAqcnbsRkk9hxI9n9wZKt9GdwmG5GyG+mZS7AeIYBRyfuwHimEMVB+CfOcABuRsheTic1NlSaGy78mzWAjt2xDIcbgUOyN0M30wALsndCPGDw3bgeEBzXUrdIQ7t6ILIHhxejIahxOOwETg8dyN8cxhwWO5GSD4Op/u7X3kP2G0N8LncjfDNq4DuyZU9OGy3P5OVfYGS/7kD0C6Q7MHhmvR2exyP0w3pXUCvMw7QDrDsweEUYJx9VHX+3zfqh/1AAjjY/hyZuxGSz1C3Au/fDiDY/n8HOpJB9s/hO/CqZN/1xPsT1BbZi8MvgJNyNyG0k+3xL7nbIfkMdSJYDhwE7JerISENfChsT7Y/v+9u4vbfC+6xA9i2Lf0TvdMOuGVLgSXLYPWaxI8fwNGF9w9h85rn7AO6e/gccDjwoL+7yZb+wONLYMfOZI/f7Q6nnwb23QcWvgDtnXD//bB2bfJtqMCJhY/78FH/AK7DdqB4E3B0gn0H8E3g9cADwPa0j9/TAUecDNOnwaOL4NlFsLV9/89JmL8J9R0xqDfvNBXg/xI5wDbgEmAN8G7gNWkHwu7jjBwOl1wIs86CZc/CE4/Clq37f27S/C0o+cOZ2e0A/xN4B7b7+2uC51jfBe4G/gn8L+ET3C3uy+HY4+GCy2DmLHjySVi0CLZsy9uu4XJ2xFRnOkBXOgV/PXAH8DLwpcQfP/P/P4b/c3jD1TB+FDz2GKx4Oe+ZwL7c2fCvNGNYvwWOz/aYALcCy4Dzcp4NFAI/PgD4g/3Q1cC5Djj3Ahg9Bh54CHpz3eobOr/T2FEL5wNXZR/gNjfBkDu3r/5RoInAfwC3AO8AbgKeSvqYhTv9TQa2v03+8K8GDgG+DZwP3JjrIVDfNgZpq8G9wHXATUmf4+/OJAuwYw88cD/0ZJkE3WsfBQ8FfgD8x34vyH5CZq9VqPMYqVWFfAcfBf/kfj/wcRJ1H+C72wJthv7bgOscMCXBHXD3EezyEnb1B2DhQv4rhdPsb+7UgJPQpO3AVcB/gG9lPM7bONsOXb7F/nPnAx9K5KT2LGC/yyB3J9S/A+9JsIN3bHHY2Qk8D/wdewPiJDpwqz2LeyXBWfU+S3LJPbPuduzrg/xWgvNLBm4A7gH+D9gx3FWp7o7B8/r4D8D5wCvD+b2B2gQ8ASwH7oW0A8HucR7AJwiO2J3OAz4I/Cyxs2z/a3A+4NnAT0n+Yus5hRsH9LjCXgX4d+Bz2J2o7hpn+F9gzwQes9/b53gHiON7gCXAbZnO8reyZ1tXAD9IsgPHLIDd3gH4Gvbt3WV2+7Ps4c4gbwC+sPd9D+oA4b2BTYy8sZ8u2F2BRxzv3yP43E7gbcBGe/xLEvvqk0M9hQPuS6wjfx+oFJM8CTcXjp9p7/P5Kbl2Lb2Swo5V5gMXJ3cYt8shzLNyN6I6/h4a6Cqr+z44APu2c+TqgJHawLmGeyC5JtTgBeDfhfe/BRzZ/09O+zQgd9PsD4LbgQ8CHyLh4N9tBvAO4i/kTOb+FnwN+wZhfHctPBt4lv++q7UbOB/o2u0K4h17LuAR/B8qLCxc57cU/i74r+PH/s9ZhQPYDPwV+CXwHfsS9N2W2e0N+zSgL8wBngH+DfwDexFq35/sE8LdgP8G/wMD9i/A/4B3F74e/JLCh0+uIT4E/D3xR/wccDV2lXEV9q4rKP/X7X+f/wPgP8D37QOUV7BDmufYv3a2kF8jH7CtXQ/0HuBZ4ErgL6n96r+Gew/wNvAQMAN4E/A2e7YkKy4DroV/AQ+y1z0y5BPwPOAZ+0Pg78D+2AnM/q68u4qQzzkJuxh4CPgq8BJ2dvA+e4jdLgWeZoRdC7wMnALczR6fIeyPh/7VDgCfB74MvA74LPBx/2nKAAbOWQB+5gAvso//AP8H/A64xv59AP8BfJTC9cT1wO3Y5x94N/AS+9wDQ71GuI0AP58bJDAoAgbA2E0Bt2FfH+S/WbQB78cO/91Bf9d2uYJ9HbDw/VuBx4DLsWt3bsSucv0CmI293PoQdn1xAPuE8EXgX+xzo+Ce+uXyweXSb4dJwCXAN4C7sWdY97J3DwD4P4d/Bk8AjgX+Abwf+M4AH7MA/xR8kP32Kc4B/gG8DPhH4F7siuEjsK+r/Wb2HO/6AngSuAF4FLs7fL39WfM64EPYY7W6AtXVeAY7gv4v4JfAZdg50Kuwq70LgZ+xc5f/Aq4F/sW+O/AG+47rEuzNg+8B/oN9W/EvgH+wd/uSfxZ+LXyAPbvbDNyBfQF5O/v+yv4/wD8B/8IOeH7X/7nyfuxLXe8EPsX+C0n/wYrMAfYhwFLCQKCHB1YD3GnvcfIq9uHCV4H/Bv7cfjkG+JD9P3Ys9oXL2Psx7wFeB7wIPIm9rfpV9qXpn8Y/M4F/+i9sZt+d/SLwZuBu9hq03hS/x/4B8DZgLvY2K/8APIX9g+BXKYz/vwPfxM5H+Q/QAPf0fvP7LuxtzLPP3wu0YV+kXIOdDbsJ+Bb2pdd/2Lv9d2CfvPsc9vbq/dh3KZrP3g+HHvL/38c/BriNPd8IbMTeyPsZdr1vLfb92DuxR29+yV4P97LnB9kbKPdKsZuAe4A/AH8FXmGfn/UfbLfny+zHD+yv0J+wK5Z3sPds4P2+zwF7Oj7AruxeaE/C/wAL7RnCAewbAq3Y9/H/DHuD5e3sefC/2N8EvI/9H1i+DnuLdC/22qzfY3dNHiAc0J57gO6w/e3YXqg57H2ntwF7W/X79kZMQ28E9j32J/YGZifQm7sp+3IjjXdZ9W7sueXp2DtCLSK8l7sEu9t0E/b29oW++Y9dwX6AvVe2Nrf/A/wXeI59M/Ve7NuT/8OOfP5c7O7NJuAp4FvYu0GvdsCUJH6xA49lr6j+j5324B6t9iTwW+z7c6dif/y/A/8GXmBv1b4XO5+VuAf4LHA7djr0EvZ67Quw75k8Cvs6/i3Yu/M9jj0v/b9xI/b90I+xz4+vxl6k/gXwNuxu8X7Z/Y/dB32Dncs7lT1cT/1Y7J2nWoDfYl+oXQo8zN5PaP+P/Sv4J/bZz/3spbLgxb4LuxW4D7tvfAB7RHAx+69D6MTedvsC9o7QTexdjN6xr4/4B3Y39Tzs//U+e+53IfZ11u8O/d8D+Af2L4Afgn8F/oD9s+Xd/O++9uGz2Hvov8xew+ux/WL/+9h7vJ8A7mLfm9XQ/wPwE/YAd7v/u+y9s/sEdu68DfuL4EH2auhD7I2I/8meV9oB3AXcwd7fNQD7tuNl7Mns++23sI/1n8b+c30Y+/c/+AfuY/fzP+y/1D5r4J+xfwe+n/3/dGPfTjuCvVc7DRj8W+7HXNODe2zgfvv5u4G7sbdP/hq7b3+j/fz82Kt2Y7H/7X3tPBd7Wvb/2P6/0v6d/x92G+b/AT9gZ7e7AftY4F32ev8R7MnpT0/lv+c/2Lutn2T/FPkB/u+cB3gEuA97tvIW4H/xHy5/BcACxBUAAAAASUVORK5CYII=" alt="I9 Smart PDV">
        <h1>Configura√ß√µes</h1>
        <p>Alterar configura√ß√µes do sistema</p>
      </div>

      <div id="settings-error" class="error-message"></div>

      <div class="form-row">
        <div class="form-group">
          <label for="settings-ip">IP do Servidor</label>
          <input type="text" id="settings-ip" placeholder="192.168.1.100">
        </div>
        <div class="form-group">
          <label for="settings-port">Porta</label>
          <input type="number" id="settings-port" placeholder="4000">
        </div>
      </div>

      <div class="form-group">
        <label for="settings-grupo">Grupo de Empresa (opcional)</label>
        <input type="text" id="settings-grupo" placeholder="Nome ou ID do grupo">
        <p class="helper">Deixe em branco para selecionar ap√≥s login</p>
      </div>

      <div class="form-group">
        <label for="settings-empresa">Empresa (opcional)</label>
        <input type="text" id="settings-empresa" placeholder="Nome ou ID da empresa">
        <p class="helper">Deixe em branco para selecionar ap√≥s login</p>
      </div>

      <div class="form-group">
        <label for="settings-estacao">Esta√ß√£o (opcional)</label>
        <input type="text" id="settings-estacao" placeholder="C√≥digo da esta√ß√£o">
        <p class="helper">Deixe em branco para selecionar ap√≥s login</p>
      </div>

      <div class="btn-group">
        <button class="btn btn-secondary" onclick="cancelSettings()">Cancelar</button>
        <button class="btn btn-primary" onclick="saveSettings()">Salvar</button>
      </div>
    </div>
  </div>

  <script>
    // Storage keys
    const STORAGE_KEY = 'pdv_desktop_config';

    // Estado
    let connectionTested = false;

    // Inicializa√ß√£o
    document.addEventListener('DOMContentLoaded', init);

    function init() {
      // Verificar se veio com par√¢metro de configura√ß√µes
      const urlParams = new URLSearchParams(window.location.search);

      if (urlParams.get('settings') === 'true') {
        showSettings();
        return;
      }

      if (urlParams.get('wizard') === 'true') {
        showWizardWithData();
        return;
      }

      // Verificar se j√° tem configura√ß√£o
      const config = getConfig();
      if (config && config.serverIp && config.serverPort) {
        // J√° configurado, redirecionar
        redirectToPDV();
      } else {
        // Primeira vez, mostrar wizard
        showWizard();
      }
    }

    function getConfig() {
      try {
        const stored = localStorage.getItem(STORAGE_KEY);
        return stored ? JSON.parse(stored) : null;
      } catch {
        return null;
      }
    }

    function saveConfigToStorage(config) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(config));
    }

    function showLoading() {
      document.getElementById('loading-screen').classList.remove('hidden');
      document.getElementById('wizard-screen').classList.add('hidden');
      document.getElementById('settings-screen').classList.add('hidden');
    }

    function showWizard() {
      document.getElementById('loading-screen').classList.add('hidden');
      document.getElementById('wizard-screen').classList.remove('hidden');
      document.getElementById('settings-screen').classList.add('hidden');

      // Carregar valores salvos se existirem
      const config = getConfig();
      if (config) {
        document.getElementById('server-ip').value = config.serverIp || 'localhost';
        document.getElementById('server-port').value = config.serverPort || '4000';
      }
    }

    async function showWizardWithData() {
      document.getElementById('loading-screen').classList.add('hidden');
      document.getElementById('wizard-screen').classList.remove('hidden');
      document.getElementById('settings-screen').classList.add('hidden');

      // Carregar todos os valores salvos
      const config = getConfig();
      if (config) {
        document.getElementById('server-ip').value = config.serverIp || 'localhost';
        document.getElementById('server-port').value = config.serverPort || '4000';

        // Carregar campos opcionais
        document.getElementById('grupo-empresa').value = config.grupoEmpresa || '';
        document.getElementById('empresa').value = config.empresa || '';
        document.getElementById('estacao').value = config.estacao || '';

        // Se j√° tem IP/porta configurados, mostrar como conex√£o testada
        if (config.serverIp && config.serverPort) {
          connectionTested = true;
          document.getElementById('connection-status').classList.remove('hidden');
          document.getElementById('next-btn').disabled = false;
          document.getElementById('next-btn').style.opacity = '1';
        }
      }
    }

    function showSettings() {
      document.getElementById('loading-screen').classList.add('hidden');
      document.getElementById('wizard-screen').classList.add('hidden');
      document.getElementById('settings-screen').classList.remove('hidden');

      // Carregar valores salvos
      const config = getConfig();
      if (config) {
        document.getElementById('settings-ip').value = config.serverIp || '';
        document.getElementById('settings-port').value = config.serverPort || '';
        document.getElementById('settings-grupo').value = config.grupoEmpresa || '';
        document.getElementById('settings-empresa').value = config.empresa || '';
        document.getElementById('settings-estacao').value = config.estacao || '';
      }
    }

    function showError(elementId, message) {
      const el = document.getElementById(elementId);
      el.textContent = message;
      el.style.display = 'block';
    }

    function hideError(elementId) {
      document.getElementById(elementId).style.display = 'none';
    }

    function goToStep2() {
      document.getElementById('step1').classList.add('hidden');
      document.getElementById('step2').classList.remove('hidden');
      hideError('error-message');
    }

    function goToStep1() {
      document.getElementById('step2').classList.add('hidden');
      document.getElementById('step1').classList.remove('hidden');
      hideError('error-message');
    }

    async function testConnection() {
      hideError('error-message');

      const ip = document.getElementById('server-ip').value.trim();
      const port = document.getElementById('server-port').value.trim();

      if (!ip || !port) {
        showError('error-message', 'Preencha o IP e a porta do servidor');
        return;
      }

      // Mostrar loading
      document.getElementById('test-btn-text').textContent = 'Testando...';
      document.getElementById('test-spinner').classList.remove('hidden');

      try {
        const url = `http://${ip}:${port}`;

        // Testar conex√£o com o frontend usando fetch com timeout
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 5000);

        const response = await fetch(url, {
          method: 'HEAD',
          mode: 'no-cors',
          signal: controller.signal
        });

        clearTimeout(timeoutId);

        // Se chegou aqui, a conex√£o foi bem-sucedida (mesmo com no-cors)
        connectionTested = true;
        document.getElementById('connection-status').classList.remove('hidden');
        document.getElementById('next-btn').disabled = false;
        document.getElementById('next-btn').style.opacity = '1';
      } catch (error) {
        if (error.name === 'AbortError') {
          showError('error-message', 'Tempo de conex√£o esgotado. Verifique se o servidor est√° rodando.');
        } else {
          showError('error-message', `N√£o foi poss√≠vel conectar ao servidor: ${error.message || 'Verifique IP e porta'}`);
        }
      } finally {
        document.getElementById('test-btn-text').textContent = 'Testar Conex√£o';
        document.getElementById('test-spinner').classList.add('hidden');
      }
    }

    function saveConfig() {
      const config = {
        serverIp: document.getElementById('server-ip').value.trim(),
        serverPort: document.getElementById('server-port').value.trim(),
        grupoEmpresa: document.getElementById('grupo-empresa').value.trim() || null,
        empresa: document.getElementById('empresa').value.trim() || null,
        estacao: document.getElementById('estacao').value.trim() || null,
        configuredAt: new Date().toISOString()
      };

      saveConfigToStorage(config);
      redirectToPDV();
    }

    function redirectToPDV() {
      const config = getConfig();
      if (!config || !config.serverIp || !config.serverPort) {
        showWizard();
        return;
      }

      showLoading();

      // Construir URL com par√¢metros
      let url = `http://${config.serverIp}:${config.serverPort}`;
      const params = new URLSearchParams();

      if (config.grupoEmpresa) params.set('grupoEmpresa', config.grupoEmpresa);
      if (config.empresa) params.set('empresa', config.empresa);
      if (config.estacao) params.set('estacao', config.estacao);
      params.set('desktop', 'true');

      const queryString = params.toString();
      if (queryString) {
        url += '?' + queryString;
      }

      // Redirecionar
      window.location.href = url;
    }

    // Fun√ß√µes de Settings
    function saveSettings() {
      const config = {
        serverIp: document.getElementById('settings-ip').value.trim(),
        serverPort: document.getElementById('settings-port').value.trim(),
        grupoEmpresa: document.getElementById('settings-grupo').value.trim() || null,
        empresa: document.getElementById('settings-empresa').value.trim() || null,
        estacao: document.getElementById('settings-estacao').value.trim() || null,
        configuredAt: new Date().toISOString()
      };

      if (!config.serverIp || !config.serverPort) {
        showError('settings-error', 'IP e Porta s√£o obrigat√≥rios');
        return;
      }

      saveConfigToStorage(config);
      redirectToPDV();
    }

    function cancelSettings() {
      const config = getConfig();
      if (config && config.serverIp) {
        redirectToPDV();
      } else {
        showWizard();
      }
    }

    // Expor fun√ß√£o para o Tauri chamar
    window.openSettings = function() {
      window.location.href = window.location.pathname + '?settings=true';
    };
  </script>
</body>
</html>
